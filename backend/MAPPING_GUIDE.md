# 재직자 명부 데이터 매핑 가이드

## 1. 재직자 명부 컬럼 정의

### 📋 표준 컬럼 매핑

| 번호 | 원본 컬럼명 | 표준 컬럼명 | 데이터 타입 | 필수 여부 | 설명 |
|------|------------|------------|------------|----------|------|
| 1 | 사원번호 | `emp_id` | string | ✅ 필수 | 사원 고유 번호 |
| 2 | 생년월일 | `birth_date` | string (YYYY-MM-DD) | ✅ 필수 | 생년월일 (YYYYMMDD → YYYY-MM-DD 변환) |
| 3 | 성별 (1:남자, 2:여자) | `gender` | int | ✅ 필수 | 1: 남자, 2: 여자 |
| 4 | 입사일자 | `hire_date` | string (YYYY-MM-DD) | ✅ 필수 | 입사일 (날짜 형식 통일) |
| 5 | 기준급여 | `base_salary` | float | ✅ 필수 | 급여액 |
| 6 | 당년도퇴직급여추계액 | `current_year_severance` | float | ⚠️ 권장 | 당년도 퇴직급여 추계액 |
| 7 | 차년도퇴직급여추계액 | `next_year_severance` | float | ⚠️ 권장 | 차년도 퇴직급여 추계액 |
| 8 | 중업원 구분 (1:직원, 3:임원, 4:계약직) | `employee_type` | int | ✅ 필수 | 1: 직원, 3: 임원, 4: 계약직 |
| 9 | 중간정산기준일 | `interim_settlement_date` | string (YYYY-MM-DD) | ❌ 선택 | 중간정산 기준일 |
| 10 | 중간정산액 | `interim_settlement_amount` | float | ❌ 선택 | 중간정산 금액 |
| 11 | 제도구분 (1,2,3) | `plan_type` | int | ✅ 필수 | 1, 2, 3 중 하나 |
| 12 | 적용배수 | `applicable_multiplier` | float | ⚠️ 권장 | 배수 값 |

### 📝 필드 상세 설명

#### 1. 사원번호 (`emp_id`)
- **원본 형식**: 숫자 (예: 120009001)
- **변환 규칙**: 
  - 숫자를 문자열로 변환
  - 앞뒤 공백 제거
  - 0으로 시작하는 경우 유지
- **예시**: `120009001` → `"120009001"`

#### 2. 생년월일 (`birth_date`)
- **원본 형식**: YYYYMMDD (예: 19670702)
- **변환 규칙**: 
  - YYYYMMDD → YYYY-MM-DD 형식으로 변환
  - 6자리(YYMMDD)인 경우: 50년 기준으로 19xx/20xx 판단
- **예시**: 
  - `19670702` → `"1967-07-02"`
  - `691224` → `"1969-12-24"`

#### 3. 성별 (`gender`)
- **원본 형식**: 숫자 1 또는 2
- **변환 규칙**: 정수형으로 변환
- **유효값**: 1 (남자), 2 (여자)
- **예시**: `1` → `1`

#### 4. 입사일자 (`hire_date`)
- **원본 형식**: YYYY-MM-DD 또는 datetime
- **변환 규칙**: YYYY-MM-DD 형식으로 통일
- **예시**: `2000-09-01` → `"2000-09-01"`

#### 5. 기준급여 (`base_salary`)
- **원본 형식**: 숫자 (콤마 포함 가능)
- **변환 규칙**: 
  - 콤마 제거
  - float 타입으로 변환
- **예시**: `47,270,000` → `47270000.0`

#### 6-7. 퇴직급여추계액 (`current_year_severance`, `next_year_severance`)
- **원본 형식**: 숫자 (콤마 포함 가능)
- **변환 규칙**: 콤마 제거 후 float 변환
- **예시**: `3,592,520,000` → `3592520000.0`

#### 8. 중업원 구분 (`employee_type`)
- **원본 형식**: 숫자 1, 3, 4
- **변환 규칙**: 정수형으로 변환
- **유효값**: 
  - 1: 직원
  - 3: 임원
  - 4: 계약직
- **예시**: `3` → `3`

#### 9. 중간정산기준일 (`interim_settlement_date`)
- **원본 형식**: 날짜 (비어있을 수 있음)
- **변환 규칙**: YYYY-MM-DD 형식으로 변환
- **예시**: `2018-12-01` → `"2018-12-01"`

#### 10. 중간정산액 (`interim_settlement_amount`)
- **원본 형식**: 숫자 (비어있을 수 있음)
- **변환 규칙**: float 타입으로 변환
- **예시**: `29,773,730` → `29773730.0`

#### 11. 제도구분 (`plan_type`)
- **원본 형식**: 숫자 1, 2, 3
- **변환 규칙**: 정수형으로 변환
- **유효값**: 1, 2, 3
- **예시**: `3` → `3`

#### 12. 적용배수 (`applicable_multiplier`)
- **원본 형식**: 숫자
- **변환 규칙**: float 타입으로 변환
- **예시**: `3` → `3.0`

## 2. 검증 규칙

### ✅ 필수 필드 검증
- `emp_id`, `birth_date`, `gender`, `hire_date`, `base_salary`, `employee_type`, `plan_type`는 반드시 값이 있어야 함
- 비어있거나 null인 경우 오류 발생

### ⚠️ 권장 필드 검증
- `current_year_severance`, `next_year_severance`, `applicable_multiplier`는 권장 필드
- 비어있는 경우 경고 발생 (오류 아님)

### 🔍 데이터 타입 검증
- `gender`: 1 또는 2만 허용
- `employee_type`: 1, 3, 4만 허용
- `plan_type`: 1, 2, 3만 허용
- 숫자 필드: 음수 불가 (급여, 퇴직금 등)

### 📅 날짜 검증
- 모든 날짜는 YYYY-MM-DD 형식
- `hire_date`는 현재 날짜보다 이전이어야 함
- `birth_date`는 유효한 날짜여야 함

### 🔁 중복 검증
- `emp_id`는 시트 내에서 중복 불가
- 중복 발견 시 해당 행 번호와 함께 오류 발생

## 3. 매핑 프로세스

```
[엑셀 파일] 
    ↓
[ExcelReader] - 시트 읽기
    ↓
[DataMapper] - 컬럼명 매핑 및 데이터 정형화
    ↓
[DataValidator] - 데이터 검증
    ↓
[검증 결과 반환]
```

## 4. 사용 예시

### Python 코드
```python
from services.excel_reader import ExcelReader
from services.data_mapper import DataMapper
from services.validator import DataValidator

# 1. 엑셀 읽기
reader = ExcelReader("sample.xlsx")
sheets_data = reader.read_all_sheets()

# 2. 데이터 매핑
mapper = DataMapper()
mapped_data = mapper.map_all_sheets(sheets_data)

# 3. 검증
validator = DataValidator()
results = validator.validate(mapped_data)
```

### 테스트 실행
```bash
cd backend
python test_mapping.py
```

## 5. 퇴직자 및 DC전환자 명부 컬럼 정의

### 📋 표준 컬럼 매핑

| 번호 | 원본 컬럼명 | 표준 컬럼명 | 데이터 타입 | 설명 |
|------|------------|------------|------------|------|
| 1 | 사원번호 | `emp_id` | string | 사원 고유 번호 |
| 2 | 생년월일 | `birth_date` | string (YYYY-MM-DD) | 생년월일 (YYYYMMDD → YYYY-MM-DD 변환) |
| 3 | 성별 (1:남자, 2:여자) | `gender` | int | 1: 남자, 2: 여자 |
| 4 | 입사일자 | `hire_date` | string (YYYY-MM-DD) | 입사일 (YYYYMMDD → YYYY-MM-DD 변환) |
| 5 | 퇴직일 또는 DC전환일 | `retirement_or_dc_date` | string (YYYY-MM-DD) | 퇴직일 또는 DC전환일 (YYYYMMDD → YYYY-MM-DD 변환) |
| 6 | 퇴직금 또는 DC전환금 | `retirement_or_dc_amount` | float | 퇴직금 또는 DC전환금 (-, null 가능) |
| 7 | 중업원 구분 (1:직원, 3:임원, 4:계약직) | `employee_type` | int | 1: 직원, 3: 임원, 4: 계약직 |
| 8 | 사유 (1: 퇴직, 2: DC전환) | `reason` | int | 1: 퇴직, 2: DC전환 |
| 9 | 제도구분 (1,2,3) | `plan_type` | int | 1, 2, 3 중 하나 |

### 📝 필드 상세 설명

#### 1. 사원번호 (`emp_id`)
- **원본 형식**: 숫자 (예: 122101001)
- **변환 규칙**: 숫자를 문자열로 변환, 앞뒤 공백 제거
- **예시**: `122101001` → `"122101001"`

#### 2. 생년월일 (`birth_date`)
- **원본 형식**: YYYYMMDD (예: 19660222)
- **변환 규칙**: YYYYMMDD → YYYY-MM-DD 형식으로 변환
- **예시**: `19660222` → `"1966-02-22"`

#### 3. 성별 (`gender`)
- **원본 형식**: 숫자 1 또는 2
- **유효값**: 1 (남자), 2 (여자)
- **예시**: `1` → `1`

#### 4. 입사일자 (`hire_date`)
- **원본 형식**: YYYYMMDD (예: 20210101)
- **변환 규칙**: YYYYMMDD → YYYY-MM-DD 형식으로 변환
- **예시**: `20210101` → `"2021-01-01"`

#### 5. 퇴직일 또는 DC전환일 (`retirement_or_dc_date`)
- **원본 형식**: YYYYMMDD (예: 20241231)
- **변환 규칙**: YYYYMMDD → YYYY-MM-DD 형식으로 변환
- **예시**: `20241231` → `"2024-12-31"`

#### 6. 퇴직금 또는 DC전환금 (`retirement_or_dc_amount`)
- **원본 형식**: 숫자 (콤마 포함 가능, `-`로 표시된 경우도 있음)
- **변환 규칙**: 콤마, 하이픈 제거 후 float 변환, `-`는 null로 처리
- **예시**: 
  - `155,520,000` → `155520000.0`
  - `-` → `None`

#### 7. 중업원 구분 (`employee_type`)
- **원본 형식**: 숫자 1, 3, 4
- **유효값**: 1 (직원), 3 (임원), 4 (계약직)
- **예시**: `3` → `3`

#### 8. 사유 (`reason`)
- **원본 형식**: 숫자 1 또는 2
- **유효값**: 1 (퇴직), 2 (DC전환)
- **예시**: `1` → `1`

#### 9. 제도구분 (`plan_type`)
- **원본 형식**: 숫자 1, 2, 3
- **유효값**: 1, 2, 3
- **예시**: `1` → `1`

## 6. 추가명부 컬럼 정의

### 📋 표준 컬럼 매핑

| 번호 | 원본 컬럼명 | 표준 컬럼명 | 데이터 타입 | 설명 |
|------|------------|------------|------------|------|
| 1 | 사원번호 | `emp_id` | string | 사원 고유 번호 (앞에 0 포함 가능) |
| 2 | 생년월일 | `birth_date` | string (YYYY-MM-DD) | 생년월일 |
| 3 | 성별 (1:남자, 2:여자) | `gender` | int | 1: 남자, 2: 여자 |
| 4 | 입사일자 | `hire_date` | string (YYYY-MM-DD) | 입사일 |
| 5 | 기준급여 | `base_salary` | float | 급여액 |
| 6 | 사유발생일 시점 발생금액 | `reason_occurrence_amount` | float | 사유발생일 시점의 발생금액 |
| 7 | 중업원 구분 (1:직원, 3:임원, 4:계약직) | `employee_type` | int | 1: 직원, 3: 임원, 4: 계약직 |
| 8 | 중간정산기준일 | `interim_settlement_date` | string (YYYY-MM-DD) | 중간정산 기준일 (선택) |
| 9 | 사유 (1:관계사전입, 2:관계사전출, 3:사업합병전, 4:사업합병후, 5:기타장기종업원) | `reason` | int | 1~5 사유 코드 |
| 10 | 사유발생일 | `reason_occurrence_date` | string (YYYY-MM-DD) | 사유가 발생한 날짜 |

### 📝 필드 상세 설명

#### 1. 사원번호 (`emp_id`)
- **원본 형식**: 숫자 (예: 2120, 0725)
- **변환 규칙**: 
  - 문자열로 변환
  - 앞에 0이 있는 경우 유지
  - 4자리 미만이면 0으로 패딩
- **예시**: 
  - `2120` → `"2120"`
  - `725` → `"0725"`

#### 2. 생년월일 (`birth_date`)
- **원본 형식**: YYYY-MM-DD (예: 1976-11-08)
- **변환 규칙**: YYYY-MM-DD 형식 유지
- **예시**: `1976-11-08` → `"1976-11-08"`

#### 3. 성별 (`gender`)
- **원본 형식**: 숫자 1 또는 2
- **유효값**: 1 (남자), 2 (여자)
- **예시**: `1` → `1`

#### 4. 입사일자 (`hire_date`)
- **원본 형식**: YYYY-MM-DD (예: 2017-01-01)
- **변환 규칙**: YYYY-MM-DD 형식 유지
- **예시**: `2017-01-01` → `"2017-01-01"`

#### 5. 기준급여 (`base_salary`)
- **원본 형식**: 숫자 (콤마 포함 가능)
- **변환 규칙**: 콤마 제거 후 float 변환
- **예시**: `6,708,898` → `6708898.0`

#### 6. 사유발생일 시점 발생금액 (`reason_occurrence_amount`)
- **원본 형식**: 숫자 (콤마 포함 가능)
- **변환 규칙**: 콤마 제거 후 float 변환
- **예시**: `47,521,360` → `47521360.0`

#### 7. 중업원 구분 (`employee_type`)
- **원본 형식**: 숫자 1, 3, 4
- **유효값**: 1 (직원), 3 (임원), 4 (계약직)
- **예시**: `1` → `1`

#### 8. 중간정산기준일 (`interim_settlement_date`)
- **원본 형식**: YYYY-MM-DD (비어있을 수 있음, `-`로 표시)
- **변환 규칙**: YYYY-MM-DD 형식, `-`는 null로 처리
- **예시**: 
  - `2018-07-01` → `"2018-07-01"`
  - `-` → `None`

#### 9. 사유 (`reason`)
- **원본 형식**: 숫자 1~5
- **유효값**: 
  - 1: 관계사전입
  - 2: 관계사전출
  - 3: 사업합병전
  - 4: 사업합병후
  - 5: 기타장기종업원
- **예시**: `2` → `2`

#### 10. 사유발생일 (`reason_occurrence_date`)
- **원본 형식**: YYYY-MM-DD (예: 2025-08-01)
- **변환 규칙**: YYYY-MM-DD 형식 유지
- **예시**: `2025-08-01` → `"2025-08-01"`

## 7. 기타장기 재직자 명부 (선택사항)

**참고**: 기타장기 재직자 명부는 **선택사항**입니다. 파일에 시트가 있으면 읽고, 없으면 건너뜁니다.

기본적인 매핑 구조는 재직자 명부와 유사하게 처리됩니다:
- 사원번호, 생년월일, 성별, 입사일자, 기준급여, 중업원 구분 등

## 8. 전체 요약

### ✅ 완료된 명부 정형화

| 명부 | 컬럼 수 | 필수 여부 | 상태 |
|-----|--------|----------|------|
| **(2-2) 재직자 명부** | 12개 | ✅ 필수 | ✅ 완료 |
| **(2-4) 퇴직자 및 DC전환자 명부** | 9개 | ✅ 필수 | ✅ 완료 |
| **(2-5) 추가명부** | 10개 | ✅ 필수 | ✅ 완료 |
| **(2-3) 기타장기 재직자 명부** | 6개 | ❌ 선택 | ✅ 완료 (있을 때만) |

### 🔄 데이터 처리 흐름

```
[엑셀 파일 업로드]
    ↓
[ExcelReader] - 4개 시트 자동 탐색
    ├── (2-2) 재직자 명부 ✅ 필수
    ├── (2-3) 기타장기 재직자 명부 (있으면 읽음)
    ├── (2-4) 퇴직자 및 DC전환자 명부 ✅ 필수
    └── (2-5) 추가명부 ✅ 필수
    ↓
[DataMapper] - 각 시트별 컬럼 매핑 및 정형화
    ├── 날짜 형식 통일 (YYYY-MM-DD)
    ├── 숫자 정형화 (콤마 제거, float 변환)
    ├── 코드 값 검증 (성별, 직원구분, 사유 등)
    └── 사원번호 정형화
    ↓
[DataValidator] - 데이터 검증
    ├── 기본 검증 (현재 구현됨)
    └── 상세 검증 규칙 (추후 추가 예정)
    ↓
[검증 결과 반환]
    ├── 전체/유효/오류 레코드 수
    ├── 오류 목록 (시트, 행, 컬럼, 메시지)
    └── 경고 목록
```

### 🎯 주요 정형화 규칙

1. **날짜 필드**: 모두 YYYY-MM-DD 형식으로 통일
2. **숫자 필드**: 콤마 제거, `-`는 null로 처리
3. **사원번호**: 문자열 변환, 앞의 0 보존
4. **코드 값**: 정해진 범위 내의 값만 허용

### 📊 API 엔드포인트

- **POST /api/upload**: 파일 업로드 및 기본 정보 확인
- **POST /api/validate**: 파일 업로드 및 전체 검증 수행
- **GET /health**: 서버 상태 확인

## 9. 다음 단계

- [x] 재직자 명부 매핑 규칙 정의 ✅
- [x] 퇴직자 및 DC전환자 명부 매핑 규칙 정의 ✅
- [x] 추가명부 매핑 규칙 정의 ✅
- [x] 기타장기 재직자 명부 기본 구조 ✅
- [ ] 검증 규칙 상세화 (필수/선택 필드, 비즈니스 로직)
- [ ] 크로스 시트 검증 규칙 추가 (사원번호 중복 등)
- [ ] 프론트엔드 연동
- [ ] 리포트 생성 기능 추가

